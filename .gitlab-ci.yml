image: fedora:latest

cache:
  key: dnf
  paths:
  - /var/cache/dnf

before_script:
  - dnf --quiet --assumeyes install /usr/bin/cmake "pkgconfig(libjpeg)" "pkgconfig(openal)" "pkgconfig(sdl)" "pkgconfig(glu)" "pkgconfig(libpng)" "pkgconfig(zlib)" "pkgconfig(vorbis)" "pkgconfig(vorbisfile)" "pkgconfig(ogg)" make

build_gcc:
  stage: build
  script:
    - dnf --quiet --assumeyes install gcc gcc-c++
    - export CC=gcc; export CXX=g++; mkdir -p x86_64-linux-gnu-gcc gcc-build; cd x86_64-linux-gnu-gcc; cmake .. -DLUGARU_INSTALL_PREFIX=/builds/osslugaru/lugaru/gcc-build; make -j4; make install
  artifacts:
    expire_in: 7d
    paths:
      - ./gcc-build
  tags:
    - shared

build_clang:
  stage: build
  script:
    - dnf --quiet --assumeyes install clang
    - export CC=clang; export CXX=clang++; mkdir -p x86_64-linux-gnu-clang clang-build; cd x86_64-linux-gnu-clang; cmake .. -DLUGARU_INSTALL_PREFIX=/builds/osslugaru/lugaru/clang-build; make -j4; make install
  artifacts:
    expire_in: 7d
    paths:
      - ./clang-build
  tags:
    - shared
